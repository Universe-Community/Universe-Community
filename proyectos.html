<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universe Community - Proyectos Optimizados</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

    <header class="site-header" id="siteHeader">
        <div class="container header-inner">
            <a href="index.html" class="logo-link" aria-label="Universe Community Home">
                <div class="logo-icon-box"><span class="logo-abbr">UC</span></div>
                <span class="logo-full-text">Universe Community</span>
            </a>
            <button class="theme-toggle-button" id="themeToggleBtn" aria-label="Cambiar tema" title="Cambiar tema">
                <i class="fas fa-moon" aria-hidden="true"></i>
                <i class="fas fa-sun" aria-hidden="true"></i>
            </button>
            <button class="nav-toggle" id="navToggleBtn" aria-label="Abrir menú de navegación" aria-expanded="false" aria-controls="mainMenuNav">
                <i class="fas fa-bars" aria-hidden="true"></i>
            </button>
            <nav class="main-menu" id="mainMenuNav" aria-label="Navegación principal">
                <ul>
                    <li class="has-submenu">
                        <a href="index.html" aria-haspopup="true" aria-expanded="false">
                            Universe Community
                            <span class="submenu-toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </a>
                        <ul class="submenu level-2">
                            <li><a href="index.html">Inicio</a></li>
                            <li><a href="index.html#proyectos-destacados">Proyectos</a></li>
                            <li><a href="index.html#donaciones">Donar</a></li>
                            <li><a href="index.html#comunidad">Contacto</a></li>
                            <li><a href="index.html#soporte-contacto">Soporte</a></li>
                        </ul>
                    </li>
                    <li class="has-submenu">
                        <a href="proyectos.html" aria-haspopup="true" aria-expanded="false">
                            Proyectos
                            <span class="submenu-toggle-icon"><i class="fas fa-chevron-down"></i></span>
                        </a>
                        <ul class="submenu level-2">
                            <li class="has-submenu">
                                <a href="proyecto-alpha.html" aria-haspopup="true" aria-expanded="false">
                                    Proyecto Alpha
                                    <span class="submenu-toggle-icon level2-arrow"><i class="fas fa-chevron-right"></i></span>
                                </a>
                                <ul class="submenu level-3">
                                    <li><a href="proyecto-alpha.html#inicio">Inicio del Proyecto</a></li>
                                    <li><a href="proyecto-alpha.html#detalles">Detalles</a></li>
                                </ul>
                            </li>
                            <li class="has-submenu">
                                <a href="proyecto-beta.html" aria-haspopup="true" aria-expanded="false">
                                    Proyecto Beta
                                    <span class="submenu-toggle-icon level2-arrow"><i class="fas fa-chevron-right"></i></span>
                                </a>
                                <ul class="submenu level-3">
                                    <li><a href="proyecto-beta.html#inicio">Inicio del Proyecto</a></li>
                                </ul>
                            </li>
                            <li class="has-submenu">
                                <a href="proyecto-gamma.html" aria-haspopup="true" aria-expanded="false">
                                    Proyecto Gamma
                                    <span class="submenu-toggle-icon level2-arrow"><i class="fas fa-chevron-right"></i></span>
                                </a>
                                <ul class="submenu level-3">
                                    <li><a href="proyecto-gamma.html#inicio">Inicio del Proyecto</a></li>
                                </ul>
                            </li>
                            <li class="has-submenu">
                                <a href="proyecto-delta.html" aria-haspopup="true" aria-expanded="false">
                                    Proyecto Delta
                                    <span class="submenu-toggle-icon level2-arrow"><i class="fas fa-chevron-right"></i></span>
                                </a>
                                <ul class="submenu level-3">
                                    <li><a href="proyecto-delta.html#inicio">Inicio del Proyecto</a></li>
                                </ul>
                            </li>
                            <li class="has-submenu">
                                <a href="proyecto-epsilon.html" aria-haspopup="true" aria-expanded="false">
                                    Proyecto Epsilon
                                    <span class="submenu-toggle-icon level2-arrow"><i class="fas fa-chevron-right"></i></span>
                                </a>
                                <ul class="submenu level-3">
                                    <li><a href="proyecto-epsilon.html#inicio">Inicio del Proyecto</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="announcement-carousel-section">
            <div class="container">
                <h2 class="block-title"> Anuncios Destacados </h2>
                <div class="carousel-container" id="announcementsCarousel" aria-roledescription="carousel" aria-label="Anuncios importantes de proyectos">
                    <div class="carousel-slides" id="carouselSlides">
                        <div class="carousel-slide active" role="group" aria-roledescription="slide" aria-label="1 de 4">
                            <img src="https://placehold.co/960x450/6A11CB/FFFFFF?text=Nuevo+Proyecto+Alpha" alt="Anuncio Nuevo Proyecto Alpha" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/960x450/cccccc/333333?text=Imagen+no+disponible';">
                            <div class="carousel-caption">
                                <h3>¡Explora el Proyecto Alpha!</h3>
                                <p>Sumérgete en simulaciones cósmicas interactivas y expande tu conocimiento del universo.</p>
                            </div>
                        </div>
                        <div class="carousel-slide" role="group" aria-roledescription="slide" aria-label="2 de 4">
                            <img src="https://placehold.co/960x450/2575FC/FFFFFF?text=Evento+Educativo+Beta" alt="Anuncio Evento Educativo Beta" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/960x450/cccccc/333333?text=Imagen+no+disponible';">
                            <div class="carousel-caption">
                                <h3>Educación Abierta con Proyecto Beta</h3>
                                <p>Descubre herramientas educativas innovadoras y gratuitas para todas las comunidades.</p>
                            </div>
                        </div>
                        <div class="carousel-slide" role="group" aria-roledescription="slide" aria-label="3 de 4">
                             <img src="https://placehold.co/960x450/FF5733/FFFFFF?text=Colabora+en+Gamma" alt="Anuncio Colabora en Gamma" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/960x450/cccccc/333333?text=Imagen+no+disponible';">
                            <div class="carousel-caption">
                                <h3>¡Únete al Proyecto Gamma!</h3>
                                <p>Buscamos mentes creativas para fusionar el arte y la tecnología digital de vanguardia.</p>
                            </div>
                        </div>
                         <div class="carousel-slide" role="group" aria-roledescription="slide" aria-label="4 de 4">
                             <img src="https://placehold.co/960x450/33FF57/212121?text=IA+Sostenible+Delta" alt="Anuncio IA Sostenible Delta" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/960x450/cccccc/333333?text=Imagen+no+disponible';">
                            <div class="carousel-caption">
                                <h3>Innovación Sostenible con Delta</h3>
                                <p>Descubre cómo la Inteligencia Artificial puede ayudar a proteger nuestro planeta para el futuro.</p>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-button prev" aria-label="Anuncio anterior"><i class="fas fa-chevron-left" aria-hidden="true"></i></button>
                    <button class="carousel-button next" aria-label="Siguiente anuncio"><i class="fas fa-chevron-right" aria-hidden="true"></i></button>
                    <div class="carousel-dots" aria-label="Navegación de anuncios">
                    </div>
                </div>
                <div class="carousel-view-all-container">
                    <a href="todos-los-anuncios.html" class="btn-view-all-announcements">Ver Todos los Anuncios <i class="fas fa-arrow-right"></i></a>
                </div>
            </div>
        </section>
        <section class="content-block projects-page-wrapper" id="todos-los-proyectos">
            <div class="container">
                <h1 class="block-title gradient-title"> Explora Nuestros Proyectos </h1>
                <p class="block-subtitle">
                    Descubre la diversidad de iniciativas que nuestra comunidad está impulsando con pasión. Desde desarrollos tecnológicos pioneros hasta proyectos sociales y creativos de gran impacto, cada uno es una puerta abierta para aprender, colaborar y co-crear un futuro mejor.
                </p>

                <div class="projects-grid">
                    <article class="project-card-detailed">
                        <div class="project-img-placeholder">
                             <span>[Imagen Representativa del Proyecto Alpha]</span>
                        </div>
                        <div class="project-content">
                            <p class="project-category">Exploración y Simulación</p>
                            <h3 class="project-title"><a href="proyecto-alpha.html">Proyecto Alpha</a></h3>
                            <p class="project-description-full">
                                El Proyecto Alpha se enfoca en la creación de simulaciones interactivas del universo, permitiendo a los usuarios explorar conceptos cósmicos complejos de una manera visual y atractiva. Buscamos fomentar la curiosidad científica y el aprendizaje a través de la tecnología.
                            </p>
                            <a href="proyecto-alpha.html" class="btn-view-project-page">Ver detalles <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </article>

                    <article class="project-card-detailed">
                        <div class="project-img-placeholder">
                            <span>[Imagen Representativa del Proyecto Beta]</span>
                        </div>
                        <div class="project-content">
                             <p class="project-category">Educación y Código Abierto</p>
                            <h3 class="project-title"><a href="proyecto-beta.html">Proyecto Beta</a></h3>
                            <p class="project-description-full">
                                Este proyecto está dedicado al desarrollo de herramientas educativas innovadoras y de código abierto. Nuestro objetivo es hacer que el aprendizaje de calidad sea accesible para comunidades globales, promoviendo la colaboración y el conocimiento compartido.
                            </p>
                            <a href="proyecto-beta.html" class="btn-view-project-page">Ver detalles <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </article>

                    <article class="project-card-detailed">
                        <div class="project-img-placeholder">
                            <span>[Imagen Representativa del Proyecto Gamma]</span>
                        </div>
                        <div class="project-content">
                            <p class="project-category">Arte y Tecnología Digital</p>
                            <h3 class="project-title"><a href="proyecto-gamma.html">Proyecto Gamma</a></h3>
                            <p class="project-description-full">
                                Proyecto Gamma explora la intersección entre la expresión artística y las nuevas tecnologías digitales. Fomentamos la creación de obras interactivas, visualizaciones de datos creativas y experiencias inmersivas que desafían los límites tradicionales del arte.
                            </p>
                            <a href="proyecto-gamma.html" class="btn-view-project-page">Ver detalles <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </article>
                    
                    <article class="project-card-detailed">
                        <div class="project-img-placeholder">
                            <span>[Imagen Representativa del Proyecto Delta]</span>
                        </div>
                        <div class="project-content">
                            <p class="project-category">IA y Sostenibilidad</p>
                            <h3 class="project-title"><a href="proyecto-delta.html">Proyecto Delta</a></h3>
                            <p class="project-description-full">
                                Centrado en la investigación y aplicación de la Inteligencia Artificial para abordar desafíos de sostenibilidad ambiental. Desarrollamos modelos y herramientas para la conservación de recursos, monitoreo ecológico y promoción de prácticas sostenibles.
                            </p>
                            <a href="proyecto-delta.html" class="btn-view-project-page">Ver detalles <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </article>

                    <article class="project-card-detailed">
                        <div class="project-img-placeholder">
                           <span>[Imagen Representativa del Proyecto Epsilon]</span>
                        </div>
                        <div class="project-content">
                             <p class="project-category">Comunidad y Mentoría</p>
                            <h3 class="project-title"><a href="proyecto-epsilon.html">Proyecto Epsilon</a></h3>
                            <p class="project-description-full">
                                Epsilon es una plataforma comunitaria diseñada para facilitar el intercambio de habilidades y la mentoría entre pares. Conectamos a personas con diferentes niveles de experiencia para fomentar el aprendizaje colaborativo y el desarrollo profesional.
                            </p>
                            <a href="proyecto-epsilon.html" class="btn-view-project-page">Ver detalles <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </article>
                    
                    <article class="project-card-detailed">
                        <div class="project-img-placeholder">
                           <span>[Imagen Representativa del Proyecto Zeta]</span>
                        </div>
                        <div class="project-content">
                            <p class="project-category">Salud y Bienestar Digital</p>
                            <h3 class="project-title"><a href="proyecto-zeta.html">Proyecto Zeta</a></h3>
                            <p class="project-description-full">
                                Este proyecto se dedica a desarrollar soluciones digitales que promuevan la salud mental y el bienestar. Creamos aplicaciones y recursos para ayudar a las personas a gestionar el estrés, mejorar la atención plena y acceder a apoyo emocional.
                            </p>
                            <a href="proyecto-zeta.html" class="btn-view-project-page">Ver detalles <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </article>
                </div>
            </div>
        </section>
    </main>

    <a href="https://wa.me/TUNUMERODEWHATSAPP" target="_blank" class="floating-action-button" title="Contactar por WhatsApp" aria-label="Contactar por WhatsApp">
        <i class="fab fa-whatsapp" aria-hidden="true"></i>
    </a>

    <footer class="site-footer-detailed">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-column footer-column-brand">
                    <a href="index.html" class="footer-logo-link" aria-label="Universe Community Home">
                        <div class="footer-logo-icon-box"><span class="footer-logo-abbr">UC</span></div>
                        <span class="footer-logo-full-text">Universe Community</span>
                    </a>
                    <p class="footer-description">
                        Una comunidad global dedicada a crear, innovar y conectar personas a través de proyectos colaborativos que transforman ideas en realidad.
                    </p>
                </div>
                 <div class="footer-column footer-column-contact">
                    <h4 class="footer-heading">Contacto Directo</h4>
                     <div class="footer-direct-contact">
                        <a href="https://wa.me/TUNUMERODEWHATSAPP" target="_blank" aria-label="Contactar por WhatsApp">
                            <i class="fab fa-whatsapp" aria-hidden="true"></i> WhatsApp
                        </a>
                        <a href="https://t.me/TUNOMBREDECANALTELEGRAM" target="_blank" aria-label="Contactar por Telegram">
                            <i class="fab fa-telegram-plane" aria-hidden="true"></i> Telegram
                        </a>
                         <a href="mailto:contacto@universecommunity.com" aria-label="Enviar correo electrónico">
                            <i class="fas fa-envelope" aria-hidden="true"></i> Email
                        </a>
                    </div>
                </div>
                <div class="footer-column footer-column-social">
                    <h4 class="footer-heading">Síguenos</h4>
                    <div class="footer-social-icons">
                        <a href="#" target="_blank" title="Facebook" aria-label="Visita nuestra página de Facebook"><i class="fab fa-facebook-f" aria-hidden="true"></i></a>
                        <a href="#" target="_blank" title="Twitter / X" aria-label="Visita nuestro perfil de Twitter"><i class="fab fa-x-twitter" aria-hidden="true"></i></a>
                        <a href="#" target="_blank" title="Instagram" aria-label="Visita nuestro perfil de Instagram"><i class="fab fa-instagram" aria-hidden="true"></i></a>
                        <a href="#" target="_blank" title="Discord" aria-label="Únete a nuestro servidor de Discord"><i class="fab fa-discord" aria-hidden="true"></i></a>
                        <a href="#" target="_blank" title="YouTube" aria-label="Visita nuestro canal de YouTube"><i class="fab fa-youtube" aria-hidden="true"></i></a>
                        <a href="#" target="_blank" title="LinkedIn" aria-label="Visita nuestro perfil de LinkedIn"><i class="fab fa-linkedin-in" aria-hidden="true"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom-bar">
                <p>&copy; <span id="currentYear"></span> Universe Community. Todos los derechos reservados. Diseñado con <i class="fas fa-heart" style="color: #e25555;"></i>.</p>
            </div>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const siteHeader = document.getElementById('siteHeader');
        let headerHeight = 0;

        function updateHeaderHeightAndPadding() {
            if (siteHeader) {
                headerHeight = siteHeader.offsetHeight;
                document.body.style.paddingTop = `${headerHeight}px`;
                document.documentElement.style.setProperty('--header-height', `${headerHeight}px`);
            }
        }
        
        updateHeaderHeightAndPadding();
        window.addEventListener('resize', updateHeaderHeightAndPadding);

        // --- Theme Toggle Logic ---
        const themeToggleBtn = document.getElementById('themeToggleBtn');
        const currentTheme = localStorage.getItem('theme');

        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }

        if (currentTheme) {
            applyTheme(currentTheme);
        } else { // Check system preference if no theme is stored
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (prefersDark) {
                applyTheme('dark');
                localStorage.setItem('theme', 'dark'); // Save system preference as initial choice
            }
        }


        if (themeToggleBtn) {
            themeToggleBtn.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                let theme = 'light';
                if (document.body.classList.contains('dark-mode')) {
                    theme = 'dark';
                }
                localStorage.setItem('theme', theme);
            });
        }

        // --- Mobile Navigation Menu Logic ---
        const navToggleBtn = document.getElementById('navToggleBtn');
        const mainMenuNav = document.getElementById('mainMenuNav');
        const navIcon = navToggleBtn ? navToggleBtn.querySelector('i') : null;

        if (navToggleBtn && mainMenuNav && navIcon) {
            navToggleBtn.addEventListener('click', () => {
                const isExpanded = mainMenuNav.classList.toggle('menu-visible');
                navToggleBtn.setAttribute('aria-expanded', String(isExpanded));
                navIcon.classList.toggle('fa-bars', !isExpanded);
                navIcon.classList.toggle('fa-times', isExpanded);

                if (!isExpanded) { 
                    mainMenuNav.querySelectorAll('.has-submenu.open').forEach(openSubmenuLi => {
                        openSubmenuLi.classList.remove('open');
                        const link = openSubmenuLi.querySelector('a[aria-haspopup="true"]');
                        if (link) link.setAttribute('aria-expanded', 'false');
                        const submenu = openSubmenuLi.querySelector('.submenu');
                        if (submenu && window.innerWidth <= 991) submenu.style.maxHeight = null;
                    });
                }
            });
        }

        if (mainMenuNav) {
            mainMenuNav.querySelectorAll('li.has-submenu').forEach(listItem => {
                const link = listItem.querySelector('a[aria-haspopup="true"]');
                const toggleIcon = listItem.querySelector('.submenu-toggle-icon');
                const submenu = listItem.querySelector('.submenu');

                if (toggleIcon && submenu) {
                    toggleIcon.addEventListener('click', (event) => {
                        event.preventDefault();
                        event.stopPropagation();
                        toggleSubmenu(listItem, link, submenu);
                    });
                }
                
                if (link && submenu) {
                     link.addEventListener('click', (event) => {
                        if (event.target.closest('.submenu-toggle-icon')) {
                            return;
                        }
                        if (window.innerWidth <= 991 || !link.getAttribute('href') || link.getAttribute('href') === '#') {
                            event.preventDefault();
                            toggleSubmenu(listItem, link, submenu);
                        }
                    });
                }
            });
        }
        
        function toggleSubmenu(listItem, link, submenu) {
            const isOpen = listItem.classList.toggle('open');
            if (link) link.setAttribute('aria-expanded', String(isOpen));
            
            if (window.innerWidth <= 991) { 
                if (isOpen) {
                    submenu.style.maxHeight = submenu.scrollHeight + "px";
                } else {
                    submenu.style.maxHeight = null;
                    submenu.querySelectorAll('.has-submenu.open').forEach(openChild => {
                        const childLink = openChild.querySelector('a[aria-haspopup="true"]');
                        const childSubmenu = openChild.querySelector('.submenu');
                        openChild.classList.remove('open');
                        if(childLink) childLink.setAttribute('aria-expanded', 'false');
                        if(childSubmenu) childSubmenu.style.maxHeight = null;
                    });
                }
            }
        }

        if (mainMenuNav) {
            mainMenuNav.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', (event) => {
                    if (mainMenuNav.classList.contains('menu-visible') && link.getAttribute('href') && link.getAttribute('href') !== '#') {
                        const isSubmenuToggleItself = link.querySelector('.submenu-toggle-icon') && (window.innerWidth <= 991 || !link.getAttribute('href') || link.getAttribute('href') === '#');
                        if (event.target.closest('.submenu-toggle-icon') || isSubmenuToggleItself) {
                            return;
                        }
                        mainMenuNav.classList.remove('menu-visible');
                        if (navToggleBtn) navToggleBtn.setAttribute('aria-expanded', 'false');
                        if (navIcon) {
                            navIcon.classList.remove('fa-times');
                            navIcon.classList.add('fa-bars');
                        }
                        mainMenuNav.querySelectorAll('.has-submenu.open').forEach(openSubmenuLi => {
                            openSubmenuLi.classList.remove('open');
                            const parentLink = openSubmenuLi.querySelector('a[aria-haspopup="true"]');
                            if (parentLink) parentLink.setAttribute('aria-expanded', 'false');
                            const submenu = openSubmenuLi.querySelector('.submenu');
                            if (submenu && window.innerWidth <= 991) submenu.style.maxHeight = null;
                        });
                    }
                });
            });
        }

        function updateCurrentPage() { 
            if (!mainMenuNav) return;
            const currentUrlPath = window.location.pathname.split('/').pop() || 'index.html';
            const currentUrlHash = window.location.hash;

            mainMenuNav.querySelectorAll('a').forEach(navLink => {
                navLink.classList.remove('current-page'); 
                const linkHref = navLink.getAttribute('href');
                if (!linkHref) return;

                const linkFullUrl = new URL(linkHref, window.location.origin);
                const linkPath = linkFullUrl.pathname.split('/').pop() || 'index.html';
                const linkHash = linkFullUrl.hash;
                
                let isActive = false;

                if (linkPath === currentUrlPath) {
                    if (linkHash) { 
                        if (linkHash === currentUrlHash) isActive = true;
                    } else { 
                        if (!currentUrlHash || currentUrlHash === "#") isActive = true; 
                    }
                }
                
                if (isActive) {
                    navLink.classList.add('current-page');
                    let currentElementForParentCheck = navLink;
                    while (currentElementForParentCheck) {
                        const parentSubmenuUl = currentElementForParentCheck.closest('ul.submenu');
                        if (!parentSubmenuUl) break; 
                        const parentLi = parentSubmenuUl.parentElement; 
                        if (!parentLi || !parentLi.classList.contains('has-submenu')) break;
                        const parentAnchor = parentLi.querySelector(':scope > a[aria-haspopup="true"]'); 
                        if (parentAnchor) {
                            parentAnchor.classList.add('current-page'); 
                        } else { break; }
                        if (parentLi.parentElement === mainMenuNav.querySelector('ul')) { break; }
                        currentElementForParentCheck = parentLi; 
                    }
                }
            });
        }
        
        const sections = document.querySelectorAll("main section[id]"); 
        const allNavLinks = mainMenuNav ? mainMenuNav.querySelectorAll("nav ul li a") : [];

        function navHighlighter() {
            if (!mainMenuNav || allNavLinks.length === 0) return;

            let scrollY = window.pageYOffset;
            let currentActiveSectionId = null;
            const currentPagePath = window.location.pathname.split('/').pop() || 'index.html';

            sections.forEach((current) => { 
                if (!current) return;
                const sectionHeight = current.offsetHeight;
                const sectionTop = current.offsetTop - 150; 
                let sectionId = current.getAttribute("id");

                if (scrollY >= sectionTop && scrollY < sectionTop + sectionHeight) {
                    currentActiveSectionId = sectionId;
                }
            });
            
            allNavLinks.forEach((navLink) => {
                const href = navLink.getAttribute("href");
                if (!href) return;

                const linkUrl = new URL(href, window.location.origin);
                const linkPath = linkUrl.pathname.split('/').pop() || 'index.html';
                const linkHash = linkUrl.hash;

                if (linkPath === currentPagePath && linkHash && linkHash === "#" + currentActiveSectionId) {
                    allNavLinks.forEach(nl => nl.classList.remove("current-page-scroll"));
                    navLink.classList.add("current-page-scroll"); 
                }
            });
            updateCurrentPage();

            const scrolledActive = mainMenuNav.querySelector('a.current-page-scroll');
            if (scrolledActive) {
                scrolledActive.classList.add('current-page');
                 let currentElementForParentCheck = scrolledActive;
                    while (currentElementForParentCheck) {
                        const parentSubmenuUl = currentElementForParentCheck.closest('ul.submenu');
                        if (!parentSubmenuUl) break; 
                        const parentLi = parentSubmenuUl.parentElement; 
                        if (!parentLi || !parentLi.classList.contains('has-submenu')) break;
                        const parentAnchor = parentLi.querySelector(':scope > a[aria-haspopup="true"]'); 
                        if (parentAnchor) {
                            parentAnchor.classList.add('current-page'); 
                        } else { break; }
                        if (parentLi.parentElement === mainMenuNav.querySelector('ul')) { break; }
                        currentElementForParentCheck = parentLi; 
                    }
            }
            mainMenuNav.querySelectorAll('a.current-page-scroll').forEach(l => l.classList.remove('current-page-scroll'));
        }

        if (sections.length > 0 && allNavLinks.length > 0) { 
            window.addEventListener("scroll", navHighlighter);
        }
        updateCurrentPage(); 
        window.addEventListener('hashchange', updateCurrentPage); 


        // --- Carousel Logic ---
        const carouselContainer = document.getElementById('announcementsCarousel');
        if (carouselContainer) {
            const slidesContainer = carouselContainer.querySelector('.carousel-slides');
            const slides = Array.from(carouselContainer.querySelectorAll('.carousel-slide'));
            const prevButton = carouselContainer.querySelector('.carousel-button.prev');
            const nextButton = carouselContainer.querySelector('.carousel-button.next');
            const dotsContainer = carouselContainer.querySelector('.carousel-dots');
            
            let currentIndex = 0;
            let slideInterval;
            const slideCount = slides.length;
            let isDragging = false;
            let startPosX = 0;
            let currentTranslate = 0;
            let prevTranslate = 0;
            const swipeThreshold = 50;

            if (slideCount > 0) {
                for (let i = 0; i < slideCount; i++) {
                    const dot = document.createElement('button'); 
                    dot.classList.add('carousel-dot');
                    dot.setAttribute('aria-label', `Ir al anuncio ${i + 1}`);
                    if (i === 0) dot.classList.add('active');
                    dot.addEventListener('click', () => { goToSlide(i); resetInterval(); });
                    dotsContainer.appendChild(dot);
                }
                const dots = Array.from(dotsContainer.querySelectorAll('.carousel-dot'));

                function applyTransition() { slidesContainer.style.transition = 'var(--transition-carousel)'; }
                function removeTransition() { slidesContainer.style.transition = 'none'; }

                function setPositionByIndex() {
                    if (slidesContainer) { 
                        currentTranslate = currentIndex * -slidesContainer.offsetWidth;
                        prevTranslate = currentTranslate;
                        applyTransition();
                        slidesContainer.style.transform = `translateX(${currentTranslate}px)`;
                    }
                }

                function updateCarouselState() {
                    setPositionByIndex();
                    slides.forEach((slide, index) => {
                        slide.classList.toggle('active', index === currentIndex); 
                        slide.setAttribute('aria-hidden', String(index !== currentIndex));
                        slide.inert = (index !== currentIndex); 
                    });
                    dots.forEach((dot, index) => {
                        dot.classList.toggle('active', index === currentIndex);
                        dot.setAttribute('aria-current', String(index === currentIndex));
                    });
                }

                function goToSlide(index) { currentIndex = (index + slideCount) % slideCount; updateCarouselState(); }
                function nextSlide() { goToSlide(currentIndex + 1); }
                function prevSlide() { goToSlide(currentIndex - 1); }

                if (nextButton) nextButton.addEventListener('click', () => { nextSlide(); resetInterval(); });
                if (prevButton) prevButton.addEventListener('click', () => { prevSlide(); resetInterval(); });
                
                function startInterval() { clearInterval(slideInterval); slideInterval = setInterval(nextSlide, 6000); }
                function resetInterval() { clearInterval(slideInterval); startInterval(); }
                
                slidesContainer.addEventListener('touchstart', touchStart, { passive: true });
                slidesContainer.addEventListener('touchmove', touchMove, { passive: true });
                slidesContainer.addEventListener('touchend', touchEnd);
                slidesContainer.addEventListener('mousedown', touchStart);
                slidesContainer.addEventListener('mousemove', touchMove);
                slidesContainer.addEventListener('mouseup', touchEnd);
                slidesContainer.addEventListener('mouseleave', touchEnd);

                function touchStart(event) {
                    isDragging = true;
                    startPosX = getPositionX(event);
                    removeTransition(); 
                    carouselContainer.classList.add('grabbing');
                    clearInterval(slideInterval); 
                }

                function touchMove(event) {
                    if (isDragging) {
                        const currentPosition = getPositionX(event);
                        currentTranslate = prevTranslate + currentPosition - startPosX;
                        slidesContainer.style.transform = `translateX(${currentTranslate}px)`;
                    }
                }

                function touchEnd() {
                    if (!isDragging) return;
                    isDragging = false;
                    carouselContainer.classList.remove('grabbing');
                    const movedBy = currentTranslate - prevTranslate;
                    applyTransition(); 
                    if (movedBy < -swipeThreshold && currentIndex < slideCount - 1) { currentIndex += 1; }
                    if (movedBy > swipeThreshold && currentIndex > 0) { currentIndex -= 1; }
                    updateCarouselState(); 
                    resetInterval(); 
                }

                function getPositionX(event) { return event.type.includes('mouse') ? event.pageX : event.touches[0].clientX; }
                
                updateCarouselState(); 
                startInterval(); 

                carouselContainer.addEventListener('mouseenter', () => { if(!isDragging) clearInterval(slideInterval); });
                carouselContainer.addEventListener('mouseleave', () => { if(!isDragging) startInterval(); });
                carouselContainer.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') { prevSlide(); resetInterval(); } 
                    else if (e.key === 'ArrowRight') { nextSlide(); resetInterval(); }
                });
                window.addEventListener('resize', () => {
                    removeTransition(); 
                    updateHeaderHeightAndPadding(); 
                    setPositionByIndex();
                    setTimeout(applyTransition, 50); 
                });
            }
        }

        const currentYearElement = document.getElementById('currentYear');
        if (currentYearElement) {
            currentYearElement.textContent = new Date().getFullYear();
        }
    });
    </script>

</body>
</html>
